<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HA Intercom - Web Flasher</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      background: #1a1a2e;
      color: #eee;
    }
    h1 {
      color: #4CAF50;
    }
    a {
      color: #64B5F6;
    }
    .container {
      background: #16213e;
      border-radius: 12px;
      padding: 30px;
      margin: 20px 0;
    }
    .flash-button {
      display: block;
      margin: 30px auto;
    }
    esp-web-install-button {
      display: block;
      margin: 20px auto;
    }
    esp-web-install-button::part(button) {
      background: #4CAF50;
      color: white;
      border: none;
      padding: 15px 30px;
      font-size: 18px;
      border-radius: 8px;
      cursor: pointer;
    }
    esp-web-install-button::part(button):hover {
      background: #45a049;
    }
    .requirements {
      background: #0f3460;
      padding: 15px;
      border-radius: 8px;
      margin: 20px 0;
    }
    .requirements h3 {
      margin-top: 0;
      color: #64B5F6;
    }
    ul {
      line-height: 1.8;
    }
    .warning {
      background: #e65100;
      padding: 15px;
      border-radius: 8px;
      margin: 20px 0;
    }
    .steps {
      counter-reset: step;
    }
    .steps li {
      counter-increment: step;
      margin: 15px 0;
    }
    .steps li::marker {
      content: counter(step) ". ";
      color: #4CAF50;
      font-weight: bold;
    }
  </style>
  <script type="module" src="https://unpkg.com/esp-web-tools@10/dist/web/install-button.js?module"></script>
</head>
<body>
  <h1>HA Intercom Web Flasher</h1>

  <div class="container">
    <p>Flash the HA Intercom firmware to your ESP32-S3 directly from your browser. No tools required!</p>

    <div class="requirements">
      <h3>Requirements</h3>
      <ul>
        <li><strong>Browser:</strong> Chrome or Edge (Web Serial API required)</li>
        <li><strong>Hardware:</strong> ESP32-S3-DevKitC-1 connected via USB</li>
        <li><strong>Driver:</strong> USB driver installed (usually automatic)</li>
      </ul>
    </div>

    <esp-web-install-button manifest="firmware/manifest.json">
      <button slot="activate">Install HA Intercom Firmware</button>
      <span slot="unsupported">
        Your browser doesn't support Web Serial. Please use Chrome or Edge.
      </span>
      <span slot="not-allowed">
        Serial access denied. Please grant permission when prompted.
      </span>
    </esp-web-install-button>

    <div class="warning">
      <strong>First time flashing?</strong> You may need to hold the BOOT button while clicking Install, then release after "Connecting..." appears.
    </div>
  </div>

  <div class="container">
    <h2>After Flashing</h2>
    <ol class="steps">
      <li>The device will reboot and show a blinking red LED (connecting to WiFi)</li>
      <li>If no WiFi is configured, connect to the device's AP (check serial output for name)</li>
      <li>Configure WiFi and MQTT settings via the web interface</li>
      <li>Once connected, the LED turns dim white (idle)</li>
      <li>Press and hold the BOOT button to transmit audio</li>
    </ol>
  </div>

  <div class="container">
    <h2>Hardware Setup</h2>
    <p>You'll also need:</p>
    <ul>
      <li>INMP441 I2S Microphone (~$3)</li>
      <li>MAX98357A I2S Amplifier + Speaker (~$5)</li>
    </ul>
    <p>See the <a href="https://github.com/Bri-J-C/ha-intercom/tree/main/firmware">firmware README</a> for wiring instructions.</p>
  </div>

  <div class="container">
    <h2>Alternative: Manual Flash</h2>
    <p>Prefer command-line tools? Download the binary from <a href="https://github.com/Bri-J-C/ha-intercom/releases">GitHub Releases</a> and flash with esptool:</p>
    <pre style="background:#0a0a15; padding:15px; border-radius:8px; overflow-x:auto;">esptool.py --chip esp32s3 write_flash \
  0x0 bootloader.bin \
  0x8000 partitions.bin \
  0xf000 ota_data_initial.bin \
  0x20000 firmware.bin</pre>
  </div>

  <p style="text-align:center; margin-top:40px; color:#666;">
    <a href="https://github.com/Bri-J-C/ha-intercom">View on GitHub</a>
  </p>
</body>
</html>
